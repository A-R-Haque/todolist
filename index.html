<script>
    // Firebase Database Reference
    const dbRef = firebase.database().ref();
    let currentList = 'work'; // Default list
    let lastDeletedTask = null;
    let lastDeletedIndex = null;

    document.addEventListener('DOMContentLoaded', function() {
        loadTasks(currentList);
        document.querySelectorAll('.list-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.list-btn').forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                currentList = this.getAttribute('data-list');
                document.getElementById('tasksList').innerHTML = '';
                loadTasks(currentList);
            });
        });
        document.querySelector('[data-list="work"]').click(); // Default selected list
    });

    document.getElementById('addTask').addEventListener('click', function() {
        const newTaskValue = document.getElementById('newTask').value;
        if (newTaskValue.trim() !== '') {
            addTask(newTaskValue, true);
            document.getElementById('newTask').value = '';
        }
    });

    function addTask(taskContent, save = false) {
        const tasksList = document.getElementById('tasksList');
        const newTask = document.createElement('li');
        newTask.className = 'bg-white p-2 mt-2 cursor-pointer flex items-center justify-between';
        const taskText = document.createElement('span');
        taskText.textContent = taskContent;
        taskText.className = 'task-text';
        newTask.appendChild(taskText);
        tasksList.appendChild(newTask);

        if (save) {
            saveTasks(currentList);
        }
    }

    function saveTasks(listName) {
        const tasksList = document.getElementById('tasksList');
        const tasks = Array.from(tasksList.children).map(task => task.querySelector('.task-text').textContent);
        dbRef.child(listName).set(tasks);
        if (tasksList.children.length === 0) {
            document.getElementById('undoBtn').style.display = 'none';
        }
    }

    function loadTasks(listName) {
        dbRef.child(listName).on('value', snapshot => {
            const tasks = snapshot.val();
            document.getElementById('tasksList').innerHTML = ''; // Clear current tasks
            if (tasks) {
                tasks.forEach(task => addTask(task));
            }
        });
    }
</script>
